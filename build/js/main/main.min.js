"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}svg4everybody();var CardProduct=function(){function t(e){_classCallCheck(this,t),this.id=e.id,this.imgSrc=e.imgSrc,this.price=e.price,this.productCode=e.productCode,this.quantity=e.quantity,this.rating=e.rating,this.title=e.title,this.colors=e.colors,this.size=e.size}return _createClass(t,[{key:"createCardProduct",value:function(e){var t,r,a,o,c,n,d=this,i=e.cloneNode(!0),s=i.querySelector(".product-card__form"),u=i.querySelector(".product-card__add-to-basket"),l=i.querySelector(".product-card__quantity-icon-in-stock"),p=i.querySelector(".product-card__quantity-icon-none"),f=i.querySelector(".product-card__quantity-count"),_=i.querySelector(".product-card__rating-star"),h=Array.prototype.slice.call(_.querySelectorAll(".rating-star-input")),m=_.querySelectorAll(".rating-star-label"),C=i.querySelector(".product-card__img"),y=i.querySelector(".product-card__title"),v=i.querySelector(".product-card__articul-text"),S=i.querySelector(".product-card__price");return addEventToCardButtons(i.querySelector(".product-card__add-to-basket"),this.id),C.setAttribute("src",this.imgSrc[0].src),y.textContent=this.title,v.textContent=this.productCode,S.textContent=this.price,h.forEach(function(e,t){e.id="star-rating_ID"+t+d.id,e.name="star-rating_ID"+d.id,m[t].setAttribute("for","star-rating_ID"+t+d.id),d.rating==e.value&&(e.checked=!0)}),this.quantity<=0?(f.textContent=0,l.style.display="none"):(f.textContent=this.quantity,p.style.display="none"),this.colors&&(r=(t=s.insertBefore(createOffersBlock(),u)).querySelector(".product-card__offers-title"),a=t.querySelector(".product-card__offers-wrap"),r.textContent="Цвет",this.colors.forEach(function(e,t){var r=a.appendChild(createElement("input","product-card__offers-item-input")),o=a.appendChild(createElement("label","product-card__offers-item-label")),c=o.appendChild(createElement("img","product-card__offers-item-img"));r.type="radio",r.id="color_offer_"+d.id+t,r.name="product-card__offers-color",r.value=e.nameColor,o.setAttribute("for",r.id),o.dataset.nameColor=e.nameColor,c.setAttribute("src",e.imgColor),addEventToColor(o,d.imgSrc,C),0==t&&(r.checked=!0)})),this.size&&(c=(o=s.insertBefore(createOffersBlock(),u)).querySelector(".product-card__offers-title"),n=o.querySelector(".product-card__offers-wrap"),c.textContent="Размер",this.size.forEach(function(e,t){var r=n.appendChild(createElement("input","product-card__offers-item-input")),o=n.appendChild(createElement("label","product-card__offers-item-label")),c=o.appendChild(createElement("span","product-card__offers-item-label-text"));r.type="radio",r.id="size_offer_"+d.id+t,r.name="product-card__offers-size",r.value=e,o.setAttribute("for",r.id),c.textContent=e,0==t&&(r.checked=!0)})),i}}]),t}(),xhr=new XMLHttpRequest,containerCards=document.querySelector(".products-block__tabs-content");function insertCardsProduct(e){var r=document.querySelector("#template-card").content.querySelector(".product-card"),o=document.querySelector(".products-block__tabs-content");e.forEach(function(e){var t=new CardProduct(e);o.appendChild(t.createCardProduct(r))})}function createOffersBlock(){var e=document.createElement("div"),t=document.createElement("span"),r=document.createElement("div");return e.classList.add("product-card__offers-block"),t.classList.add("product-card__offers-title"),r.classList.add("product-card__offers-wrap"),e.append(t),e.append(r),e}function createElement(e,t){var r=document.createElement(e);return r.classList.add(t),r}function addEventToCardButtons(t,r){t.addEventListener("click",function(e){e.preventDefault(),sendProduct(r,getCheckedColor(t).value,getCheckedSize(t).value)})}function getCheckedColor(e){return e.closest(".product-card").querySelector("input[name='product-card__offers-color']:checked")}function getCheckedSize(e){return e.closest(".product-card").querySelector("input[name='product-card__offers-size']:checked")}function sendProduct(e,t,r){var o=new XMLHttpRequest,c=JSON.stringify({id:e,color:t,size:r});o.open("POST","http://alex-checktask.devsotbit.ru/teaching/buy.php"),o.send(c)}function addEventToColor(t,e,r){t.addEventListener("click",function(){e.forEach(function(e){t.dataset.nameColor==e.name&&r.setAttribute("src",e.src)})})}xhr.open("POST","http://alex-checktask.devsotbit.ru/teaching/products.php"),xhr.timeout=2e3,xhr.onload=function(){200!=xhr.status?addErrorText(containerCards,"error"):(insertCardsProduct(JSON.parse(xhr.response)),removePreloader())},xhr.ontimeout=function(){addErrorText(containerCards,"timeout"),removePreloader()},xhr.send(),showPreloader();